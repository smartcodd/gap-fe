extends ./header.jade
block cuerpo
    body
        +navBar("SAAP","default","top","expand")
            +navBarNav("left")
                if USER
                    +nav_item( "/app" ,"nav-link")  Inicio
                    +nav_item_dropdown( "#" )( label="Opciones")    
                        +nav_divider
                        +nav_item( "/app/imagenes/new" ) Subir Imagen
                        +nav_item( "/app/imagenes" )  Mis Imagenes
            +navBarNav("right")
                if USER
                    +nav_item( "/logout" ) Salir
                    span.navbar-text #{USER.username}
                else
                    +nav_item( "/login" ) Iniciar Sessión
                    +nav_item( "/signup" ) Registrarse
            +nav_divider
        div(class=["container-fluid"] style="padding-top:6rem;",id="container_gap")
            .row
                +columnaAll(12,2,2,2,2,2,1,"bd-sidebar")
                    .panel.panel-default
                        .panel-heading
                            input( class="form-control" id="myInput" type="text" placeholder="Search..")
                        .panel-body
                             if listFriends
                                for friend in listFriends
                                    .sidebar-name
                                        - var tiempoConectado="";
                                        - var tiempo=0;
                                        if friend.receptor._id!=ID
                                            if friend.receptor.conected=="N" && friend.receptor.date_desconected
                                                - tiempo=friend.receptor.date_desconected.getTime();
                                        else if friend.emisor
                                            if friend.emisor.conected=="N" && friend.emisor.date_desconected
                                                - tiempo=friend.emisor.date_desconected.getTime();
                                        if tiempo > 0
                                            - var tiempoActual=(new Date()).getTime();
                                            - var tiempoMiliSe=tiempoActual-tiempo;
                                            - var tiempoSeg=tiempoMiliSe/1000;
                                            - tiempoSeg=tiempoSeg.toFixed(0);
                                            if tiempoSeg < 60
                                                - tiempoConectado=tiempoSeg+" seg";
                                            else
                                                - var tiempoMinutos=tiempoSeg/60;
                                                - tiempoMinutos=tiempoMinutos.toFixed(0);
                                                if tiempoMinutos < 60
                                                    - tiempoConectado=tiempoMinutos+" min";
                                                else
                                                    - var tiempoHoras=tiempoMinutos/60;
                                                    - tiempoHoras=tiempoHoras.toFixed(0);
                                                    if tiempoHoras < 24
                                                        - tiempoConectado=tiempoHoras+" h";
                                                    else
                                                        - var tiempoDias=tiempoHoras/24;
                                                        - tiempoDias=tiempoDias.toFixed(0);
                                                        if tiempoHoras < 7
                                                            - tiempoConectado=tiempoDias+" d";
                                                        else
                                                            - var tiempoSemanas=tiempoDias/7;
                                                            - tiempoSemanas=tiempoSemanas.toFixed(0);
                                                            if tiempoSemanas < 4
                                                                - tiempoConectado=tiempoSemanas+" sem";
                                                            else
                                                                - var tiempoMeses=tiempoSemanas/4;
                                                                - tiempoMeses=tiempoMeses.toFixed(0);
                                                                if tiempoMeses < 12
                                                                    - tiempoConectado=tiempoMeses+" meses";
                                                                else
                                                                    - var tiempoAnios=tiempoSemanas/12;
                                                                    - tiempoAnios=tiempoAnios.toFixed(0);
                                                                    - tiempoConectado=tiempoAnios+" años";
                                        if friend.receptor._id!=ID
                                            a(href="javascript:register_popup('#{friend.receptor._id}');")
                                                if friend.receptor.conected=="S"
                                                    button( type="button" class=["btn", "btn-success", "btn-circle","btn_cone"+"#{friend.receptor._id}"]  )
                                                else
                                                    button( type="button" class=["btn", "btn-default", "btn-circle","btn_cone"+"#{friend.receptor._id}"] )
                                                span( class=["glyphicon", "glyphicon-user"])
                                                span #{friend.receptor.username}
                                                span(class=["badge"] style="margin-left: 5px;font-size:8px;") 2
                                                if tiempoConectado!=""
                                                    div(class=["floatRight","timeConeccted"] style="margin-left: 5px;font-size:10px;") #{tiempoConectado}
                                                else
                                                    div(class=["floatRight","timeConeccted"] style="margin-left: 5px;font-size:10px;display:none") #{tiempoConectado}
                                        else if friend.emisor
                                            a(href="javascript:register_popup('#{friend.emisor._id}');")
                                                if friend.emisor.conected=="S"
                                                    button( type="button" class=["btn", "btn-success", "btn-circle","btn_cone"+"#{friend.emisor._id}"]  )
                                                else
                                                    button( type="button" class=["btn", "btn-default", "btn-circle","btn_cone"+"#{friend.emisor._id}"] )
                                                span( class=["glyphicon", "glyphicon-user"])
                                                span #{friend.emisor.username}
                                                span(class=["badge"] style="margin-left: 5px;font-size:8px;") 2
                                                if tiempoConectado!=""
                                                    div(class=["floatRight","timeConeccted"] style="margin-left: 5px;font-size:10px;") #{tiempoConectado}
                                                else
                                                    div(class=["floatRight","timeConeccted"] style="margin-left: 5px;font-size:10px;display:none") #{tiempoConectado}        
                            
                    if USER
                        include chat
                +columnaAll(12,10,10,10,10,4,5,"bd-content")
                    block contenido
script(id="user_connect" type="text/x-handlebars-template" src="/docs/js/socketClient.js")
    .sidebar-name
        a(href="javascript:register_popup('{{_id}}');")
            if conected=="S"
                button( type="button" class=["btn", "btn-success", "btn-circle","btn_cone"+"{{_id}}"]  )
            else
                button( type="button" class=["btn", "btn-default", "btn-circle","btn_cone"+"{{_id}}"] )
            span( class=["glyphicon", "glyphicon-user"])
            span {{username}}
            span(class=["badge"] style="margin-left: 5px;font-size:8px;") 2     
            div(class=["floatRight","timeConeccted"] style="margin-left: 5px;font-size:10px;") {{tiempo_current}}
            

                
